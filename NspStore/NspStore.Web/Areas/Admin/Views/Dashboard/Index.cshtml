@model NspStore.Web.Areas.Admin.ViewModels.DashboardStatsVm
@using NspStore.Domain.Enums
@{
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Панель управления";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-dashboard.css" />
}

<section class="section admin-dashboard">
    <div class="container">
        <h1 class="h1">Панель управления</h1>

        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-card__label">@Html.DisplayNameFor(m => m.ProductsCount)</div>
                <div class="kpi-card__value">@Model.ProductsCount</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-card__label">@Html.DisplayNameFor(m => m.CategoriesCount)</div>
                <div class="kpi-card__value">@Model.CategoriesCount</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-card__label">@Html.DisplayNameFor(m => m.UsersCount)</div>
                <div class="kpi-card__value">@Model.UsersCount</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-card__label">@Html.DisplayNameFor(m => m.OrdersCount)</div>
                <div class="kpi-card__value">@Model.OrdersCount</div>
            </div>
            <div class="kpi-card kpi-card--accent">
                <div class="kpi-card__label">@Html.DisplayNameFor(m => m.TotalRevenue)</div>
                <div class="kpi-card__value">@Model.TotalRevenue.ToString("0.00") BYN</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Recent orders -->
            <section class="dashboard-card">
                <div class="dashboard-card__header">
                    <h2 class="h2">Последние заказы</h2>
                    <a class="btn btn--secondary" asp-area="Admin" asp-controller="Orders" asp-action="Index">Все заказы</a>
                </div>
                @if (!Model.RecentOrders.Any())
                {
                    <div class="muted">Нет данных</div>
                }
                else
                {
                    <table class="table table--admin">
                        <thead>
                            <tr>
                                <th class="ta-left">@Html.DisplayNameFor(m => m.RecentOrders.First().Id)</th>
                                <th class="ta-left">@Html.DisplayNameFor(m => m.RecentOrders.First().CreatedAt)</th>
                                <th class="ta-left">@Html.DisplayNameFor(m => m.RecentOrders.First().Status)</th>
                                <th class="ta-left">@Html.DisplayNameFor(m => m.RecentOrders.First().ShippingAddress)</th>
                                <th class="ta-right">@Html.DisplayNameFor(m => m.RecentOrders.First().Total)</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var o in Model.RecentOrders)
                        {
                            <tr class="@(o.Status == OrderStatus.New ? "row--highlight" : "")">
                                <td>@o.Id</td>
                                <td>@o.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                                <td>
                                    <span class="order-status @(o.Status switch {
                                        OrderStatus.New => "order-status--new",
                                        OrderStatus.Confirmed => "order-status--paid",
                                        OrderStatus.Paid => "order-status--paid",
                                        OrderStatus.Packed => "order-status--packed",
                                        OrderStatus.Shipped => "order-status--shipped",
                                        OrderStatus.Completed => "order-status--completed",
                                        OrderStatus.Cancelled => "order-status--cancelled",
                                        _ => "order-status--new"
                                    })">
                                        @Html.DisplayFor(_ => o.Status)
                                    </span>
                                </td>
                                <td class="muted">@o.ShippingAddress</td>
                                <td class="ta-right">@o.Total.ToString("0.00") BYN</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                }
            </section>

            <!-- Top products -->
            <section class="dashboard-card">
                <div class="dashboard-card__header">
                    <h2 class="h2">Топ товаров (30 дней)</h2>
                    <a class="btn btn--secondary" asp-area="Admin" asp-controller="Products" asp-action="Index">Товары</a>
                </div>

                @if (!Model.TopProducts.Any())
                {
                    <div class="muted">Нет данных</div>
                }
                else
                {
                    <table class="table table--admin">
                        <thead>
                            <tr>
                                <th class="ta-left">@Html.DisplayNameFor(m => m.TopProducts.First().Name)</th>
                                <th class="ta-right">@Html.DisplayNameFor(m => m.TopProducts.First().Quantity)</th>
                                <th class="ta-right">@Html.DisplayNameFor(m => m.TopProducts.First().Revenue)</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var p in Model.TopProducts)
                        {
                            <tr>
                                <td>@p.Name</td>
                                <td class="ta-right">@p.Quantity</td>
                                <td class="ta-right">@p.Revenue.ToString("0.00") BYN</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                }
            </section>
        </div>
    </div>
</section>
